<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="style.css" rel="stylesheet">
    <script src="knockout-2.1.0.js" type="text/javascript"></script>
    <title>hello, Knockout.js</title>
</head>
<body>

    <h1>Hello, Knockout.js</h1>
    <p>Hello, 
        <span data-bind="text: firstName"></span>
        <span data-bind="text: lastName"></span>
        Fullname: <span data-bind="text: fullName"></span>
    </p>

    <button data-bind="click: checkout">Checkout</button>
    <button data-bind="click: addProduct">Add beer</button>
    <button data-bind="click: debugItems">debug</button>

    <table>
        <thead>
            <thead>
            <th>Product</th>
            <th>Price</th>
            </thead>
            
            
        </tr></thead>

        <tbody data-bind="foreach: shoppingCard">
            <tr>
                <td data-bind="text: nombre"></td>
                <td data-bind="text: precio"></td>
                <td><button data-bind="click: $root.removeProduct">Delete</button></td>

            </tr>
           
        </tbody>
    </table>
    total: <span data-bind="text: $root.total"></span>



    <!-- Modelo -->
    <script type="text/javascript">
        function Product(nombre, precio) {
            this.nombre = ko.observable(nombre)
            this.precio = ko.observable(precio)           
        }


        function PersonViewModel() {
            var self = this;
            this.firstName = ko.observable("John");
            this.lastName = ko.observable("Doe");

            this.fullName = ko.computed(function() {
                return this.firstName() + " " + this.lastName();
            }, this);

            this.checkout = function() {
                alert("Checkout");
            };

            this.shoppingCard = ko.observableArray([
                new Product("Product 1", 10),
                new Product("Product 2", 9.99),
                new Product("Product 3", 5),
            ])

            this.addProduct = function() {
                this.shoppingCard.push(new Product("Beer", 7.99));
            }

            self.removeProduct = function(product) {
                //self.shoppingCard.destroy(product);//_destroy permite ordenar una lista observable y extraer solo los elementos eliminados.
                self.shoppingCard.remove(product);
                //alert(self.shoppingCard().length);
                //alert(product._destroy);
            }

            this.debugItems = function() {
                var message = "";
                var nativeArray = this.shoppingCard();
                for (var i=0; i<nativeArray.length; i++) {
                message += nativeArray[i].name + "\n";
                }
                alert(message);
            };

            this.total = ko.computed(function() {
                var total = 0;
                ko.utils.arrayForEach(this.shoppingCard(), function(item) {
                    total += item.precio();
                });
                return Math.abs(total).toFixed(2); ;
            }, this);


        }

        var personViewModel = new PersonViewModel();
        ko.applyBindings(personViewModel);
</script>


</body> 
</html>